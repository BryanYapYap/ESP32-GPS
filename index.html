<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Real-Time Location Tracker</title>
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <!-- Leaflet Âú∞ÂõæÊ†∑Âºè -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body>
    <div id="map"></div>

    <script>
      const binId = "685bcd5b8960c979a5b10ee3";
      const accessKey = "$2a$10$ILjBbVQboACduWRv7UGvj.tukJnCdHhlhg3kAi.e.S3NeCZCTb5/6";
      const apiUrl = `https://api.jsonbin.io/v3/b/${binId}/latest`;

      const map = L.map("map").setView([3.8, 103.3], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; OpenStreetMap contributors',
      }).addTo(map);

      const marker = L.marker([3.8, 103.3]).addTo(map).bindPopup("Loading...").openPopup();

      async function updateLocation() {
        try {
          const res = await fetch(apiUrl, {
            headers: {
              "X-Access-Key": accessKey,
            },
          });
          const data = await res.json();
          const { lat, lng } = data.record;

          marker.setLatLng([lat, lng]);
          map.setView([lat, lng], 17);
          marker.setPopupContent(`üìç Current Location<br>Lat: ${lat}<br>Lng: ${lng}`);
        } catch (err) {
          console.error("Failed to fetch location:", err);
        }
      }

      updateLocation();
      setInterval(updateLocation, 5000);
    </script>
  </body>
</html>
