<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP32 GPS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }

    #container {
      display: flex;
      height: 100vh;
    }

    #dashboard {
      width: 220px;
      background-color: #f8f9fa;
      padding: 10px;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      font-size: 14px;
    }

    #map {
      flex: 1;
    }

    .btn {
      display: block;
      width: 100%;
      margin-top: 10px;
      padding: 6px 10px;
      background-color: #007bff;
      color: white;
      text-align: center;
      text-decoration: none;
      border-radius: 4px;
      font-size: 13px;
    }

    .btn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="dashboard">
      <h4>üì° Device Dashboard</h4>
      <div><b>ID:</b> <span id="id">Loading...</span></div>
      <div><b>Latitude:</b> <span id="lat">-</span></div>
      <div><b>Longitude:</b> <span id="lon">-</span></div>
      <div><b>Battery:</b> <span id="bat">-</span></div>
      <div><b>SOS:</b> <span id="sos">-</span></div>
      <a id="drive" class="btn" href="#" target="_blank">üöó Drive Here</a>
      <a id="street" class="btn" href="#" target="_blank">üó∫Ô∏è Street View</a>
    </div>
    <div id="map"></div>
  </div>

  <script>
    const BIN_ID = "685bcd5b8960c979a5b10ee3";
    const API_KEY = "‰Ω†ÁöÑ X-Access-Key";  // Âè™ËØª Access KeyÔºà‰∏çÊòØ Master KeyÔºâ
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;

    let map = L.map('map').setView([3.139, 101.6869], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    let marker = null;

    function updateData() {
      fetch(JSONBIN_URL, {
        headers: {
          'X-Access-Key': API_KEY
        }
      })
      .then(response => response.json())
      .then(data => {
        const record = data.record;
        const lat = record.latitude;
        const lon = record.longitude;
        const battery = record.battery || "-";
        const sos = record.sos ? "‚úÖ TRIGGERED" : "‚ùå Normal";

        document.getElementById("id").innerText = data.metadata.id;
        document.getElementById("lat").innerText = lat;
        document.getElementById("lon").innerText = lon;
        document.getElementById("bat").innerText = battery;
        document.getElementById("sos").innerText = sos;

        document.getElementById("drive").href = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
        document.getElementById("street").href = `https://www.google.com/maps?q=&layer=c&cbll=${lat},${lon}`;

        if (marker) {
          map.removeLayer(marker);
        }
        marker = L.marker([lat, lon]).addTo(map).bindPopup("Current Location").openPopup();
        map.setView([lat, lon], 17);
      })
      .catch(error => {
        console.error("Failed to fetch JSONBin:", error);
      });
    }

    updateData();
    setInterval(updateData, 10000);
  </script>
</body>
</html>
